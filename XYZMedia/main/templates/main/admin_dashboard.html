{% extends 'base.html' %}

{% block title %} Admin Dashboard {% endblock %}

{% block head %}
<style>
    
    table {
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
        border: 1px solid #DBAE58;
        text-align: left;
        padding: 8px;
        color: antiquewhite;
    }

    th {
        color: rgb(255, 210, 152);
    }

    h1, h2, h3, ul {
        color: antiquewhite;
    }

    .new_project, .resume, .approve {
        padding: 5px 8px;
        text-decoration: none;
        background-color: rgb(243, 199, 112);
        color: black;
        text-align: center;
        transition: all 0.3s;
        font-size: 15px;
        border: none;
        cursor: pointer;
    }

    .new_project:hover, .resume:hover, .approve:hover {
        background-color: rgb(169, 115, 68);
    }

    .approve:active {
        transform: scale(0.98);
    }

</style>
{% endblock %}

{% block mainbody %}
<h1>Admin Dashboard</h1>

<h2>All Projects</h2>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Project Title</th>
            <th>Status</th>
            <th>Assigned Writer</th>
            <th>Assigned Producer</th>
            <th>Assigned Compiler</th>
            <th>Due Date</th>
        </tr>
    </thead>
    
    <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.title }}</td>
            <td>{{ project.status }}</td>

            <td>
                {% if project.assigned_writer %}
                    {{ project.assigned_writer.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>

            <td>
                {% if project.assigned_producer %}
                    {{ project.assigned_producer.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>

            <td>
                {% if project.assigned_compiler %}
                    {{ project.assigned_compiler.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>
            
            <td>{{ project.due_date }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<br>
<!-- Button to Create a New Project -->
<a href="{% url 'projects:create_project' %}" class="new_project">Create New Project</a>

<!-- Section 2: Freelancer Approval -->
<h2>Freelancers Awaiting Approval</h2>
<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Resume</th>
            <th>Approve</th>
        </tr>
    </thead>
    <tbody>
        {% for profile in freelancers %}
        <tr>
            <td>{{ profile.user.username }}</td>
            <td>{{ profile.user.email }}</td>
            <td>
                {% if profile.resume %}
                    <a href="{{ profile.resume.url }}" target="_blank" class="resume">View Resume</a>
                {% else %}
                    No Resume Uploaded
                {% endif %}
            </td>
            <td>
                <form method="POST" action="{% url 'users:approve_freelancer' profile.id %}">
                    {% csrf_token %}
                    <button type="submit" class="approve">Approve</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Section 3: List of All Employees and Freelancers -->
<h2>All Employees and Freelancers</h2>
<h3>Employees</h3>
<ul>
    {% for user in employees %}
    <li>{{ user.user.username }} ({{ user.role }})</li>
    {% endfor %}
</ul>

<h3>Freelancers Awaiting Approval</h3>
<ul>
    {% for user in freelancers %}
    <li>{{ user.user.username }} ({{ user.role }}) - {% if user.is_approved %}Approved{% else %}Pending Approval{% endif %}</li>
    {% endfor %}
</ul>

<h3>Approved Freelancers</h3>
<ul>
    {% for user in freelancers_list %}
    <li>{{ user.user.username }} ({{ user.role }})</li>
    {% endfor %}
</ul>

{% endblock %}
