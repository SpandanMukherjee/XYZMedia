{% extends 'base.html' %}

{% block title %} Admin Dashboard {% endblock %}

{% block head %}
<style>
    /* General Styles */
    .mainbody {
        color: antiquewhite;
        padding: 10px;
    }

    h1, h2, h3 {
        color: rgb(255, 210, 152);
        margin-bottom: 15px;
    }

    /* Table Styles */
    table {
    width: 100%;
    border-collapse: collapse; /* Makes the table borders collapse into a single border */
    }

    th, td {
    padding: 10px;
    text-align: left;
    border: 1px solid #ddd; /* Light gray border */
    }

    tr:nth-child(odd) {
    background-color: #242424; /* Light gray for odd rows */
    }

    tr:nth-child(even) {
    background-color: #313131; /* White for even rows */
    }

    th {
    background-color: #111; /* Green header */
    color: white;
    }


    /* Button-like Links */
    .btn {
        padding: 10px 20px;
        text-decoration: none;
        background-color: rgb(243, 199, 112);
        color: black;
        font-size: 16px;
        text-align: center;
        border-radius: 5px;
        display: inline-block;
        transition: all 0.3s ease;
        margin: 5px;
        border: none;
        cursor: pointer;
    }

    .btn:hover {
        background-color: rgb(169, 115, 68);
    }

    .btn:active {
        transform: scale(0.98);
    }

    .btn-danger {
        background-color: rgb(94, 199, 73);
    }

    /* Flexbox Layout for Buttons */
    .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 30px;
    }

    /* Freelancer Section Styling */
    .resume {
        padding: 5px 10px;
        background-color: #8B6E3D;
        color: white;
        border-radius: 5px;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .resume:hover {
        background-color: #6E4B2C;
    }

    /* Aligning Tables and Spacing */
    table th, table td {
        text-align: center;
    }

</style>
{% endblock %}

{% block mainbody %}
<h1>Admin Dashboard</h1>

<h2>All Projects</h2>

<table>
    <thead>
        <tr>
            <th>Project Title</th>
            <th>Status</th>
            <th>Assigned Writer</th>
            <th>Assigned Producer</th>
            <th>Assigned Compiler</th>
            <th>Due Date</th>
        </tr>
    </thead>
    
    <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.title }}</td>
            <td>{{ project.status }}</td>

            <td>
                {% if project.assigned_writer %}
                    {{ project.assigned_writer.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>

            <td>
                {% if project.assigned_producer %}
                    {{ project.assigned_producer.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>

            <td>
                {% if project.assigned_compiler %}
                    {{ project.assigned_compiler.user.username }}
                {% else %}
                    Not Assigned
                {% endif %}
            </td>
            
            <td>{{ project.due_date }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="button-group">
    <!-- Button to Create a New Project -->
    <a href="{% url 'projects:create_project' %}" class="btn">Create New Project</a>
    <a href="{% url 'users:create_employee' %}" class="btn">Create New Employee</a>
</div>

<!-- Section 2: Freelancer Approval -->
<h2>Freelancers Awaiting Approval</h2>
<table>
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Resume</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for profile in freelancers %}
        <tr>
            <td>{{ profile.user.username }}</td>
            <td>{{ profile.user.email }}</td>
            <td>
                {% if profile.resume %}
                    <a href="{{ profile.resume.url }}" target="_blank" class="btn">View Resume</a>
                {% else %}
                    No Resume Uploaded
                {% endif %}
            </td>
            <td>
                <form method="POST" action="{% url 'users:approve_freelancer' profile.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Approve</button>
                </form>
            
                <form method="POST" action="{% url 'users:reject_freelancer' profile.user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Reject</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Section 3: List of All Employees and Freelancers -->
<h2>All Employees and Freelancers</h2>
<h3>Employees</h3>
<ul>
    {% for user in employees %}
    <li>{{ user.user.username }} ({{ user.role }})</li>
    {% endfor %}
</ul>

<h3>Freelancers Awaiting Approval</h3>
<ul>
    {% for user in freelancers %}
    <li>{{ user.user.username }} ({{ user.role }}) - {% if user.is_approved %}Approved{% else %}Pending Approval{% endif %}</li>
    {% endfor %}
</ul>

<h3>Approved Freelancers</h3>
<ul>
    {% for user in freelancers_list %}
    <li>{{ user.user.username }} ({{ user.role }})</li>
    {% endfor %}
</ul>

{% endblock %}
